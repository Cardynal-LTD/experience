<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Experience</title>
  <meta name="robots" content="noindex, nofollow">

  <!-- Theme -->
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a0a0a" media="(prefers-color-scheme: dark)">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/main.css">
</head>
<body>
  <header class="header">
    <div class="header__content">
      <a href="/" class="header__logo">Experience</a>
      <nav class="header__nav">
        <a href="/" class="header__nav-link">Home</a>
        <a href="/archive.html" class="header__nav-link">Archive</a>
        <a href="/about.html" class="header__nav-link">About</a>
      </nav>
      <button class="btn btn--ghost btn--icon" onclick="toggleTheme()" aria-label="Toggle theme">
        <svg class="sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>
  </header>

  <main class="main main--full">
    <!-- Login Section -->
    <section id="loginSection" class="page animate-fadeIn" style="max-width: 400px; margin-top: var(--space-16);">
      <div class="card">
        <div class="card__header">
          <h2 class="card__title">Connexion</h2>
          <p class="card__subtitle">Entrez votre mot de passe pour acceder a l'admin</p>
        </div>
        <div class="card__body">
          <form id="loginForm">
            <div class="form-group">
              <label class="label" for="password">Mot de passe</label>
              <input type="password" id="password" class="input" required placeholder="Entrez le mot de passe">
            </div>
            <button type="submit" class="btn btn--primary btn--block">Se connecter</button>
            <p id="loginError" class="helper-text helper-text--error" style="display: none; margin-top: var(--space-3);"></p>
          </form>
        </div>
      </div>
    </section>

    <!-- Admin Section -->
    <section id="adminSection" class="page page--wide" style="display: none;">
      <!-- Admin Header -->
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-6);">
        <div class="admin-tabs">
          <button class="admin-tab is-active" data-tab="articles">Articles</button>
          <button class="admin-tab" data-tab="analytics">Analytics</button>
        </div>
        <div style="display: flex; align-items: center; gap: var(--space-3);">
          <button class="btn btn--primary" id="newArticleBtn">+ Nouvel article</button>
          <button class="btn btn--ghost" id="logoutBtn">Deconnexion</button>
        </div>
      </div>

      <!-- Articles Tab -->
      <div class="admin-panel is-active" data-panel="articles">
        <div class="card" id="articlesList">
          <div class="empty-state">
            <div class="empty-state__icon">üìù</div>
            <div class="empty-state__title">Chargement...</div>
          </div>
        </div>
      </div>

      <!-- Analytics Tab -->
      <div class="admin-panel" data-panel="analytics">
        <!-- Stats Grid - Row 1: Vues -->
        <h3 class="stats-section-title">Vues</h3>
        <div class="stats-grid">
          <div class="stat-card stat-card--highlight">
            <span class="stat-card__icon">üëÅ</span>
            <div class="stat-card__value" id="statTotalViews">-</div>
            <div class="stat-card__label">Vues totales</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üìÖ</span>
            <div class="stat-card__value" id="statTodayViews">-</div>
            <div class="stat-card__label">Aujourd'hui</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üìä</span>
            <div class="stat-card__value" id="statWeekViews">-</div>
            <div class="stat-card__label">7 jours</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üìà</span>
            <div class="stat-card__value" id="statMonthViews">-</div>
            <div class="stat-card__label">30 jours</div>
          </div>
        </div>

        <!-- Stats Grid - Row 2: Visiteurs -->
        <h3 class="stats-section-title">Visiteurs</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-card__icon">üë§</span>
            <div class="stat-card__value" id="statUniqueVisitors">-</div>
            <div class="stat-card__label">Visiteurs uniques</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">‚ú®</span>
            <div class="stat-card__value" id="statNewVisitors">-</div>
            <div class="stat-card__label">Nouveaux</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üîÑ</span>
            <div class="stat-card__value" id="statReturning">-</div>
            <div class="stat-card__label">Retours</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">‚Ü©Ô∏è</span>
            <div class="stat-card__value" id="statBounceRate">-</div>
            <div class="stat-card__label">Taux rebond</div>
          </div>
        </div>

        <!-- Stats Grid - Row 3: Engagement -->
        <h3 class="stats-section-title">Engagement</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-card__icon">‚è±</span>
            <div class="stat-card__value" id="statAvgTime">-</div>
            <div class="stat-card__label">Temps moyen</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üìú</span>
            <div class="stat-card__value" id="statAvgScroll">-</div>
            <div class="stat-card__label">Scroll moyen</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üñ•</span>
            <div class="stat-card__value" id="statDesktop">-</div>
            <div class="stat-card__label">Desktop</div>
          </div>
          <div class="stat-card">
            <span class="stat-card__icon">üì±</span>
            <div class="stat-card__value" id="statMobile">-</div>
            <div class="stat-card__label">Mobile</div>
          </div>
        </div>

        <!-- Charts Row -->
        <h3 class="stats-section-title">Tendances</h3>
        <div class="stats-row">
          <!-- Views Chart -->
          <div class="card stats-chart-card">
            <div class="card__header">
              <h3 class="card__title"><span class="live-dot"></span>Vues (14 derniers jours)</h3>
            </div>
            <div class="card__body">
              <div class="chart-container" id="viewsChart"></div>
            </div>
          </div>

          <!-- Device Breakdown -->
          <div class="card stats-lang-card">
            <div class="card__header">
              <h3 class="card__title">Appareils</h3>
            </div>
            <div class="card__body">
              <div class="lang-stats" id="deviceStats"></div>
            </div>
          </div>
        </div>

        <!-- Second Row: Referrers & UTM -->
        <h3 class="stats-section-title">Acquisition</h3>
        <div class="stats-row stats-row--equal">
          <!-- Top Referrers -->
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">Sources de trafic</h3>
            </div>
            <div class="card__body" id="referrerStats">
              <div class="empty-state"><div class="empty-state__title">Aucune donnee</div></div>
            </div>
          </div>

          <!-- UTM Campaigns -->
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">Campagnes UTM</h3>
            </div>
            <div class="card__body" id="utmStats">
              <div class="empty-state"><div class="empty-state__title">Aucune donnee</div></div>
            </div>
          </div>
        </div>

        <!-- Top Articles -->
        <h3 class="stats-section-title">Contenu</h3>
        <div class="card">
          <div class="card__header">
            <h3 class="card__title">Articles les plus vus</h3>
          </div>
          <div class="card__body" id="topArticles">
            <div class="empty-state">
              <div class="empty-state__title">Aucune donnee</div>
            </div>
          </div>
        </div>

        <!-- Setup Instructions (hidden) -->
        <div class="card" id="analyticsSetup" style="display: none;">
          <div class="card__header">
            <h3 class="card__title">Configuration requise</h3>
          </div>
          <div class="card__body">
            <p style="margin-bottom: var(--space-4); color: var(--color-text-secondary);">
              Table page_views configuree.
            </p>
            <pre class="code-block">CREATE TABLE page_views (
  id SERIAL PRIMARY KEY,
  path TEXT NOT NULL,
  article_id INTEGER REFERENCES articles(id) ON DELETE CASCADE,
  viewed_at TIMESTAMPTZ DEFAULT NOW(),
  referrer TEXT
);</pre>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Article Modal -->
  <div class="modal-backdrop" id="articleModal">
    <div class="modal doc">
      <form id="articleForm">
        <input type="hidden" id="articleId">

        <!-- Header Actions -->
        <div class="doc__toolbar">
          <button type="submit" class="btn btn--primary btn--sm">Publier</button>
          <button type="button" class="btn btn--sm" id="cancelBtn">Annuler</button>
          <div class="doc__toolbar-spacer"></div>
          <button type="button" class="btn btn--ghost btn--icon" id="closeModalBtn" aria-label="Fermer">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        <!-- Cover Image Banner -->
        <div class="doc__banner" id="docBanner">
          <img src="" alt="" class="doc__banner-image" id="coverImage">
          <div class="doc__banner-placeholder" id="bannerPlaceholder">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/>
            </svg>
            <span>Ajouter une image de couverture</span>
          </div>
          <div class="doc__banner-actions" id="bannerActions">
            <button type="button" class="doc__banner-btn" id="changeCoverBtn">Changer</button>
            <button type="button" class="doc__banner-btn" id="removeCoverBtn">Supprimer</button>
          </div>
        </div>

        <!-- Document Header -->
        <div class="doc__header">
          <div class="doc__icon" id="docIcon" title="Choisir une icone">
            <span>üìÑ</span>
          </div>
          <input type="text" id="title" class="doc__title" required placeholder="Sans titre" autocomplete="off">
        </div>

        <!-- Meta -->
        <div class="doc__meta">
          <div class="doc__meta-row">
            <span class="doc__meta-label">Langue</span>
            <select id="lang" class="doc__meta-select">
              <option value="fr">Francais</option>
              <option value="en">English</option>
              <option value="he">◊¢◊ë◊®◊ô◊™ (Hebrew)</option>
            </select>
          </div>
          <div class="doc__meta-row">
            <span class="doc__meta-label">URL</span>
            <input type="text" id="slug" class="doc__meta-input" required placeholder="mon-article">
          </div>
          <div class="doc__meta-row">
            <span class="doc__meta-label">Tags</span>
            <input type="text" id="tags" class="doc__meta-input" placeholder="design, tech">
          </div>
          <div class="doc__meta-row">
            <span class="doc__meta-label">Traduction de</span>
            <select id="translationOf" class="doc__meta-select">
              <option value="">-- Aucune (nouvel article) --</option>
            </select>
          </div>
          <details class="doc__meta-seo">
            <summary class="doc__meta-seo-toggle">SEO (optionnel)</summary>
            <div class="doc__meta-seo-content">
              <div class="doc__meta-row">
                <span class="doc__meta-label">Meta titre</span>
                <input type="text" id="metaTitle" class="doc__meta-input" placeholder="Titre pour Google (max 70 car.)" maxlength="70">
              </div>
              <div class="doc__meta-row">
                <span class="doc__meta-label">Meta desc.</span>
                <textarea id="metaDescription" class="doc__meta-textarea" placeholder="Description pour Google (max 160 car.)" maxlength="160"></textarea>
              </div>
            </div>
          </details>
        </div>

        <!-- Editor -->
        <div id="editor" class="doc__editor"></div>
      </form>
    </div>
  </div>

  <!-- Emoji Picker Modal -->
  <div class="emoji-modal" id="emojiModal">
    <div class="emoji-modal__content">
      <div class="emoji-modal__search">
        <input type="text" class="emoji-modal__search-input" placeholder="Rechercher..." id="emojiSearch">
      </div>
      <div class="emoji-modal__list" id="emojiList"></div>
    </div>
  </div>

  <!-- Cover Upload Modal -->
  <div class="cover-modal" id="coverModal">
    <div class="cover-modal__content">
      <div class="cover-modal__tabs">
        <button type="button" class="cover-modal__tab is-active" data-tab="upload">Upload</button>
        <button type="button" class="cover-modal__tab" data-tab="url">URL</button>
      </div>
      <div class="cover-modal__panel is-active" data-panel="upload">
        <label class="cover-modal__upload">
          <input type="file" accept="image/*" id="coverFile" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          <span>Choisir une image</span>
        </label>
      </div>
      <div class="cover-modal__panel" data-panel="url">
        <input type="text" class="cover-modal__input" placeholder="https://..." id="coverUrl">
        <button type="button" class="btn btn--primary btn--sm" id="coverUrlBtn">Ajouter</button>
      </div>
    </div>
  </div>

  <script type="module" src="./js/admin.js"></script>
</body>
</html>
